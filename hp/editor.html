<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>ULTIMATE PARTY EDITOR</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800&family=VT323&display=swap" rel="stylesheet">
    <style>
        :root { --main: #ff00ff; --sec: #00ffff; --bg: #120520; --panel: #1e0a2e; }
        body { 
            background: var(--bg); color: white; font-family: 'Montserrat', sans-serif;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin:0; padding: 20px;
            background-image: 
                linear-gradient(rgba(255, 0, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 40px 40px;
        }
        h1 { 
            font-family: 'VT323', monospace; font-size: 60px; margin-bottom: 20px; 
            text-transform: uppercase; letter-spacing: 4px;
            text-shadow: 3px 3px 0 var(--sec), -3px -3px 0 var(--main);
        }
        
        .container {
            display: flex; gap: 30px; width: 1100px; max-width: 95%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(10px); padding: 30px;
            border: 2px solid var(--main); border-radius: 20px;
            box-shadow: 0 0 50px rgba(255, 0, 255, 0.3);
        }
        
        .col { flex: 1; display: flex; flex-direction: column; gap: 20px; }
        
        h2 { font-family: 'VT323'; color: var(--sec); border-bottom: 2px solid #444; margin: 0; padding-bottom: 10px; font-size: 30px; }
        
        label { display: block; font-size: 14px; color: #aaa; margin-bottom: 5px; font-weight: bold; }
        input, textarea, select {
            width: 100%; background: #0a0510; border: 2px solid #442255; color: white; padding: 15px;
            font-family: 'VT323'; font-size: 22px; border-radius: 8px; box-sizing: border-box;
            transition: 0.2s;
        }
        input:focus, textarea:focus, select:focus { border-color: var(--sec); outline: none; box-shadow: 0 0 15px var(--sec); }

        /* TAB SWITCHER */
        .tabs { display: flex; gap: 10px; margin-bottom: 15px; }
        .tab { 
            flex: 1; padding: 10px; background: #221133; border: 1px solid #442255; cursor: pointer; 
            text-align: center; font-weight: bold; border-radius: 5px; color: #888;
        }
        .tab.active { background: var(--main); color: white; border-color: white; box-shadow: 0 0 15px var(--main); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

        /* EMOTION BUTTONS */
        .emo-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .emo-btn {
            background: #221133; border: 1px solid var(--sec); color: var(--sec); padding: 10px;
            cursor: pointer; font-family: 'VT323'; font-size: 20px; border-radius: 5px;
            transition: 0.2s;
        }
        .emo-btn:hover { background: var(--sec); color: black; }
        .emo-btn.active { background: var(--sec); color: black; font-weight: bold; box-shadow: 0 0 10px var(--sec); }

        /* MAIN BUTTONS */
        .test-btn {
            background: #333; color: white; border: none; padding: 15px; width: 100%; cursor: pointer;
            font-weight: bold; border-radius: 8px; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .test-btn:hover { background: #555; }

        .pub-btn {
            background: linear-gradient(45deg, var(--main), var(--sec)); color: black; border: none;
            padding: 20px; font-size: 24px; font-weight: 900; width: 100%; cursor: pointer;
            border-radius: 10px; margin-top: 20px; text-transform: uppercase;
            box-shadow: 0 5px 20px rgba(255, 0, 255, 0.4); transition: 0.2s;
        }
        .pub-btn:hover { transform: scale(1.02); filter: brightness(1.2); }
        .pub-btn:disabled { filter: grayscale(1); cursor: wait; }

        #output { margin-top: 20px; display: none; background: black; padding: 15px; border-radius: 10px; border: 1px dashed var(--sec); }
        #status { text-align: center; color: var(--sec); margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>

<h1>üéâ GIFT EDITOR PRO üéâ</h1>

<div class="container">
    <div class="col">
        <h2>1. –ù–ê–ü–û–õ–ù–ï–ù–ò–ï</h2>
        
        <div>
            <label>–¢–µ–∫—Å—Ç –≤ –Ω–µ–±–µ (–ó–∞–≥–æ–ª–æ–≤–æ–∫):</label>
            <input type="text" id="skyMsg" value="–° –î–ù–ï–ú –†–û–ñ–î–ï–ù–ò–Ø!">
        </div>

        <div style="flex:1; display:flex; flex-direction:column;">
            <label>–§—Ä–∞–∑—ã –≤ —à–∞—Ä–∏–∫–∞—Ö (–ø–æ –æ–¥–Ω–æ–π –≤ —Å—Ç—Ä–æ–∫–µ):</label>
            <textarea id="balloons" style="flex:1; resize:none;">–¢—ã –ª—É—á—à–∏–π!
–£–¥–∞—á–∏ –≤–æ –≤—Å–µ–º!
–ë—É–¥—å —Å—á–∞—Å—Ç–ª–∏–≤!
Level Up!</textarea>
        </div>
    </div>

    <div class="col">
        <h2>2. –ù–ê–°–¢–†–û–ô–ö–ò –ì–û–õ–û–°–ê</h2>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('google', this)">GOOGLE (–ë–ï–°–ü–õ–ê–¢–ù–û)</div>
            <div class="tab" onclick="switchTab('minimax', this)">MINIMAX (API)</div>
        </div>

        <div id="tab-google" class="tab-content active">
            <label>–Ø–∑—ã–∫ –æ–∑–≤—É—á–∫–∏:</label>
            <select id="gLang">
                <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π (Russian)</option>
                <option value="en">üá∫üá∏ –ê–Ω–≥–ª–∏–π—Å–∫–∏–π (English)</option>
                <option value="de">üá©üá™ –ù–µ–º–µ—Ü–∫–∏–π (German)</option>
                <option value="fr">üá´üá∑ –§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π (French)</option>
                <option value="es">üá™üá∏ –ò—Å–ø–∞–Ω—Å–∫–∏–π (Spanish)</option>
                <option value="it">üáÆüáπ –ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π (Italian)</option>
                <option value="zh-CN">üá®üá≥ –ö–∏—Ç–∞–π—Å–∫–∏–π (Chinese)</option>
                <option value="ja">üáØüáµ –Ø–ø–æ–Ω—Å–∫–∏–π (Japanese)</option>
            </select>

            <label style="margin-top:15px">–≠–º–æ—Ü–∏—è / –ò–Ω—Ç–æ–Ω–∞—Ü–∏—è:</label>
            <div class="emo-grid">
                <div class="emo-btn active" onclick="setPreset(1, 1, this)">üòê –û–±—ã—á–Ω—ã–π</div>
                <div class="emo-btn" onclick="setPreset(1.2, 1.1, this)">üòÑ –†–∞–¥–æ—Å—Ç—å</div>
                <div class="emo-btn" onclick="setPreset(1.4, 1.3, this)">ü§™ –ú—É–ª—å—Ç–∏–∫</div>
                <div class="emo-btn" onclick="setPreset(0.8, 0.9, this)">üòé –≠–ø–∏—á–Ω—ã–π</div>
            </div>
            
            <input type="hidden" id="gPitch" value="1">
            <input type="hidden" id="gRate" value="1">

            <button class="test-btn" onclick="testGoogle()">üîä –ü–†–û–°–õ–£–®–ê–¢–¨ (–¢–ï–°–¢)</button>
        </div>

        <div id="tab-minimax" class="tab-content">
            <label>API Key:</label>
            <input type="password" id="mmKey" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á Minimax...">
            <label>Group ID:</label>
            <input type="text" id="mmGroup">
            <label>Voice ID:</label>
            <input type="text" id="mmVoice" value="male-qn-qingse">
            <button class="test-btn" onclick="testMinimax()">üîä –¢–ï–°–¢ (–°–ü–ò–®–ï–¢ –¢–û–ö–ï–ù–´)</button>
        </div>

        <button id="pubBtn" class="pub-btn" onclick="publish()">üéÅ –°–û–ó–î–ê–¢–¨ –ò–ì–†–£</button>
        <div id="status"></div>
    </div>
</div>

<div id="output" style="width: 1100px; max-width: 95%;">
    <label style="color:var(--sec)">–í–ê–®–ê –°–°–´–õ–ö–ê –ì–û–¢–û–í–ê:</label>
    <textarea id="finalCode" rows="4" readonly></textarea>
</div>

<script>
    let currentMode = 'google';
    
    // --- –ú–ê–ì–ò–Ø: –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ö–ê –ó–í–£–ö–ê ---
    // –≠—Ç–æ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –±—Ä–∞—É–∑–µ—Ä –¥—É–º–∞—Ç—å, —á—Ç–æ –º—ã —É–∂–µ –∏–≥—Ä–∞–ª–∏ –∑–≤—É–∫, 
    // –ø–æ—ç—Ç–æ–º—É –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–≤—É–∫–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è.
    function unlockAudio() {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        if (audioCtx.state === 'suspended') {
            audioCtx.resume();
        }
        const buffer = audioCtx.createBuffer(1, 1, 22050);
        const source = audioCtx.createBufferSource();
        source.buffer = buffer;
        source.connect(audioCtx.destination);
        source.start(0);
        console.log("Audio Unlocked");
    }
    // –°—Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∂–µ –∫–ª–∏–∫–µ –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
    document.body.addEventListener('click', unlockAudio, { once: true });


    function switchTab(mode, btn) {
        currentMode = mode;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById('tab-'+mode).classList.add('active');
    }

    function setPreset(pitch, rate, btn) {
        document.getElementById('gPitch').value = pitch;
        document.getElementById('gRate').value = rate;
        document.querySelectorAll('.emo-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        testGoogle(); 
    }

    function testGoogle() {
        const lang = document.getElementById('gLang').value;
        const status = document.getElementById('status');
        
        const tests = {
            'ru': "–†–∞–∑ –¥–≤–∞ —Ç—Ä–∏. –ü—Ä–æ–≤–µ—Ä–∫–∞.",
            'en': "One two three. Check.",
            'de': "Eins zwei drei. Test.",
            'fr': "Un deux trois. Test.",
            'es': "Uno dos tres. Prueba.",
            'it': "Uno due tre. Prova.",
            'zh-CN': "‰∏Ä‰∫å‰∏â„ÄÇÊµãËØï„ÄÇ",
            'ja': "‰∏Ä„ÄÅ‰∫å„ÄÅ‰∏â„ÄÇ„ÉÜ„Çπ„Éà„ÄÇ"
        };
        const text = tests[lang] || "Test.";
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å, —á—Ç–æ –º—ã –ø—ã—Ç–∞–µ–º—Å—è
        status.innerText = "‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –∑–≤—É–∫–∞...";
        status.style.color = "#aaa";

        // 1. –ü—Ä–æ–±—É–µ–º Google Hack
        const url = `https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&tl=${lang}&q=${encodeURIComponent(text)}`;
        const audio = new Audio(url);
        audio.playbackRate = parseFloat(document.getElementById('gRate').value);
        
        audio.play()
            .then(() => {
                status.innerText = "üîä –ò–≥—Ä–∞–µ—Ç Google –≥–æ–ª–æ—Å";
                status.style.color = "#00ff00";
            })
            .catch(e => {
                console.warn("Google blocked, trying fallback...");
                // 2. –ï—Å–ª–∏ Google –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª ‚Äî –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤–∫–ª—é—á–∞–µ–º –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π)
                fallbackTest(text);
            });
    }

    function fallbackTest(text) {
        const status = document.getElementById('status');
        
        if (!window.speechSynthesis) {
            status.innerText = "‚ùå –ó–≤—É–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ";
            return;
        }

        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        const lang = document.getElementById('gLang').value;
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        msg.rate = parseFloat(document.getElementById('gRate').value);
        msg.pitch = parseFloat(document.getElementById('gPitch').value);
        
        // –ò—â–µ–º –≥–æ–ª–æ—Å
        const voices = window.speechSynthesis.getVoices();
        const v = voices.find(x => x.lang.includes(lang));
        if(v) msg.voice = v;

        window.speechSynthesis.speak(msg);
        status.innerText = "‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω—ã–π –≥–æ–ª–æ—Å (Google –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)";
        status.style.color = "orange";
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –≥–æ–ª–æ—Å–æ–≤ –¥–ª—è Chrome
    if(window.speechSynthesis) window.speechSynthesis.onvoiceschanged = () => {};

    // --- –ü–£–ë–õ–ò–ö–ê–¶–ò–Ø ---
    async function publish() {
        const btn = document.getElementById('pubBtn');
        const status = document.getElementById('status');
        btn.disabled = true;
        status.innerText = "‚è≥ –°–ë–û–†–ö–ê –î–ê–ù–ù–´–•...";
        status.style.color = "#00ffff";

        const data = {
            skyText: document.getElementById('skyMsg').value,
            balloons: document.getElementById('balloons').value.split('\n').filter(x => x.trim()),
            mode: currentMode,
            googleSettings: {
                lang: document.getElementById('gLang').value,
                pitch: parseFloat(document.getElementById('gPitch').value),
                rate: parseFloat(document.getElementById('gRate').value)
            },
            audioMap: {} 
        };

        try {
            status.innerText = "üöÄ –û–¢–ü–†–ê–í–ö–ê –ù–ê –°–ï–†–í–ï–†...";
            const id = 'hp-' + Date.now().toString(36);
            
            const res = await fetch('https://publisher-server-ihqm.onrender.com/publish', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'X-Publish-Key': 'super-secret-123' },
                body: JSON.stringify({ id: id, folder: 'data', data: data })
            });

            if(!res.ok) throw new Error("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞");

            status.innerText = "‚úÖ –ì–û–¢–û–í–û!";
            status.style.color = "#00ff00";
            
            const url = `https://kgbgamelab.github.io/67/hp/index.html?id=${id}`;
            const iframe = `<iframe src="${url}" width="100%" height="100%" style="border:none; position:fixed; top:0; left:0;" allow="autoplay"></iframe>`;
            
            document.getElementById('output').style.display = 'block';
            document.getElementById('finalCode').value = iframe;

        } catch(e) {
            status.innerText = "‚ùå –û–®–ò–ë–ö–ê: " + e.message;
            status.style.color = "red";
        } finally {
            btn.disabled = false;
        }
    }
</script>
</body>
</html>
